{% extends "magazine/layout.html" %}
{% load i18n %}
{% block content %}
{% load wysiwyg %}

<div class="container text-center">    
	<div class="row">
		<div class="col-sm-12">
      		<div class="row">
      		{% if issue_is_pending == True %}
      			<div class="alert alert-success" role="alert">
      			<h3>{% trans "Well done! Your opinions are being revised to be published soon!" %}</h3>
      			</div>
      		{% else %}
      			<p>
      			<a class="btn btn-primary" href="{% url 'create_opinion_view' issue_id %}">{% trans "Propose an opinion!" %}</a>
      			</p>
       	    {% endif %}
       	    	<div class="row">
       	    	{% for opinion in opinions %}
       	    		<div class="col-sm-3">
			          <div class="well">
			           <p>{% trans "Votes: " %}</p>
			           <!-- # TODO: Refactor not to make a for here!   -->
			           {% for opinion_vote in opinion.opinion_vote_set.all %}
				           {% if opinion_vote.contributor_id = contributor_id %}
				           <h3><span class="label label-success">{% trans "You voted " %} {{ opinion_vote.vote }}</span></h3>				           
				           {% endif %}
			           {% endfor %}
			           
			           <a href="{% url 'vote_view' opinion.issue_id opinion.id 'up'%}">
			           <img class="sprite upVote"/>
			           </a>			           
			           <h3><span class="label label-warning">{{ opinion.get_votes_count }}</span></h3>
			           <a href="{% url 'vote_view' opinion.issue_id opinion.id 'down'%}">
			           <img class="sprite downVote"/>
			           </a>
			          </div>
        			</div>
			        <div class="col-sm-9">
			          <div class="panel panel-default">
				          <div class="panel-heading">
				          	<span class="label label-primary">{% trans "By: " %} {{opinion.contributor.get_short_name}}</span>
				          	<span class="label label-success">{{opinion.created_at}}</span>
				          </div>
				          <div class="panel-body text-left">
				          <p>{{ opinion.content |safe |truncatewords:50 }}</p>
				          <a href="{% url 'read_opinion_view' opinion.issue_id opinion.id %}">{% trans "Read more" %}</a>
				          </div>
			          </div>
			        </div>
			      {% endfor %}
			      </div>
      		</div>
      		
    	</div>

  </div>
</div>
	
{% endblock %}